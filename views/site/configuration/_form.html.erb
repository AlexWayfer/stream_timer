<%
	method =
		case action
		when :create then 'POST'
		when :update then 'PUT'
		else raise 'Unsupported action for configuration change form'
		end
%>

<section class="configuration change">
	<h2><%= t.site.configuration[action].header %></h2>

	<form
		class="inline table"
		method="<%= method %>"
		action="<%= path_to ST::Site::ConfigurationController, action %>"
	>
		<%= csrf_tag %>

		<% if action == :update %>
			<fieldset class="configuration_key">
				<legend><%= t.label.configuration.configuration_key %></legend>

				<p>
					<%= t.site.configuration.form.edit.configuration_key.hint %>
				</p>

				<div>
					<input type="password" value="<%= @form.instance.configuration_key %>" readonly />

					<button type="button" class="show warning" data-toggle-text="<%= t.button.hide %>">
						<%= t.button.show %>
					</button>
					<button
						type="button"
						class="success copy"
						data-toggle-text="<%= t.site.configuration.form.edit.configuration_key.copied %>"
					>
						<%= t.button.copy %>
					</button>
				</div>
			</fieldset>
		<% end %>

		<fieldset>
			<legend><%= t.label.configuration.text.common %></legend>

			<fieldset>
				<legend><%= t.label.configuration.text.countdown.common %></legend>

				<label>
					<span><%= t.label.configuration.text.countdown.before %>:</span>
					<span>
						<input
							type="text"
							name="configuration[countdown_text_before]"
							value="<%= @form.countdown_text_before %>"
							size="10"
						/>
					</span>
				</label>
			</fieldset>

			<fieldset>
				<legend><%= t.label.configuration.text.lateness.common %></legend>

				<label>
					<span><%= t.label.configuration.text.lateness.before %>:</span>
					<span>
						<input
							type="text"
							name="configuration[lateness_text_before]"
							value="<%= @form.lateness_text_before %>"
							size="10"
						/>
					</span>
				</label>
			</fieldset>
		</fieldset>

		<fieldset class="time">
			<legend><%= t.label.configuration.time.common %></legend>

			<%
				%i[hours minutes seconds].each do |time_component|
					time_limits = @form.class::TIME_LIMITS[time_component]
			%>
				<label>
					<input
						type="number"
						name="configuration[<%= time_component %>]"
						value="<%= @form.public_send(time_component) %>"
						min="<%= time_limits.begin %>"
						<% if (max = time_limits.end) %>
							max="<%= max %>"
						<% end %>
						required
					/>
					<%= t.site.configuration.form.time[time_component] %><%
						unless time_component == :seconds
							%>,<%
						end
					%>
				</label>
			<% end %>
		</fieldset>

		<fieldset>
			<legend><%= t.label.configuration.style.common %></legend>

			<fieldset>
				<legend><%= t.label.configuration.style.background.common %></legend>

				<label>
					<span><%= t.label.configuration.style.background.color %>:</span>
					<span>
						<input
							type="color"
							name="configuration[background_color]"
							value="<%= @form.background_color %>"
							required
						/>
					</span>
				</label>

				<label class="opacity">
					<span><%= t.label.configuration.style.background.opacity %>:</span>
					<span>
						<input
							type="range"
							name="configuration[background_opacity]"
							value="<%= @form.background_opacity %>"
							min="0"
							max="1"
							step="0.05"
							required
						/>
						<span class="range-value"></span><span>%</span>
					</span>
				</label>
			</fieldset>

			<fieldset>
				<legend><%= t.label.configuration.style.font.common %></legend>

				<label>
					<span><%= t.label.configuration.style.font.size %>:</span>
					<span>
						<input
							type="number"
							name="configuration[font_size]"
							value="<%= @form.font_size %>"
							min="0"
							max="9000"
							required
						/>
					</span>
				</label>

				<label>
					<span><%= t.label.configuration.style.font.color %>:</span>
					<span>
						<input
							type="color"
							name="configuration[font_color]"
							value="<%= @form.font_color %>"
							required
						/>
					</span>
				</label>
			</fieldset>
		</fieldset>

		<button type="submit" class="success"><%= t.button[action] %></button>
	</form>
</section>
